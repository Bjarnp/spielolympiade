<div class="dashboard">
  <div class="info" *ngIf="!seasonActive">
    <p>
      Die Spielolympiade beginnt bald.
      <a routerLink="/history">Historie</a>
    </p>
    <button
      mat-raised-button
      color="accent"
      *ngIf="auth.getUser()?.role === 'admin'"
      (click)="toggleStart()"
    >
      Neue Saison starten
    </button>

    <div *ngIf="showStartForm" class="start-form">
      <mat-form-field>
        <input matInput type="number" [(ngModel)]="newYear" placeholder="Jahr" />
      </mat-form-field>
      <mat-form-field>
        <input matInput [(ngModel)]="newName" placeholder="Name" />
      </mat-form-field>
      <button mat-raised-button color="primary" (click)="startSeason()">Starten</button>
    </div>
  </div>

  <ng-container *ngIf="seasonActive">

  <section class="table-section" *ngIf="tableData.length">
    <mat-card class="table-card">
      <mat-card-title>Spielolympiade {{ seasonYear }}</mat-card-title>
      <div class="table-wrapper">
        <table mat-table [dataSource]="dataSource" class="season-table mat-elevation-z8">
        <ng-container matColumnDef="place">
          <th mat-header-cell *matHeaderCellDef>Platz</th>
          <td mat-cell *matCellDef="let element; index as i">{{ i + 1 }}</td>
        </ng-container>

        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Team</th>
          <td mat-cell *matCellDef="let element">{{ element.name }}</td>
        </ng-container>

        <ng-container matColumnDef="spiele">
          <th mat-header-cell *matHeaderCellDef>Spiele</th>
          <td mat-cell *matCellDef="let element">{{ element.spiele }}</td>
        </ng-container>

        <ng-container matColumnDef="siege">
          <th mat-header-cell *matHeaderCellDef>Siege</th>
          <td mat-cell *matCellDef="let element">{{ element.siege }}</td>
        </ng-container>

        <ng-container matColumnDef="niederlagen">
          <th mat-header-cell *matHeaderCellDef>Niederl.</th>
          <td mat-cell *matCellDef="let element">{{ element.niederlagen }}</td>
        </ng-container>

        <ng-container matColumnDef="punkte">
          <th mat-header-cell *matHeaderCellDef>Punkte</th>
          <td mat-cell *matCellDef="let element">{{ element.points }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

        </table>
      </div>
    </mat-card>
  </section>

  <section *ngIf="team">
    <h2>Dein Team</h2>
    <p>{{ team.name }}</p>
  </section>

  <section *ngIf="activeGameDay">
    <h2>Spiele</h2>
    <div class="filters">
      <button mat-raised-button (click)="setFilter('all')">Alle Spiele</button>
      <button mat-raised-button (click)="setFilter('upcoming')">
        Noch zu spielende Spiele
      </button>
      <mat-checkbox [(ngModel)]="onlyMine" (change)="applyFilters()"
        >Nur meine Spiele</mat-checkbox
      >
    </div>
    <ul>
      <li *ngFor="let r of filteredGames">
        <ng-container *ngIf="r.team1Score || r.team2Score; else up">
          {{ getGameName(r.gameId) }}:
          {{ getTeamName(r.team1Id) }} ({{ r.team1Score }}) â€“
          {{ getTeamName(r.team2Id) }} ({{ r.team2Score }})
        </ng-container>
        <ng-template #up>
          {{ getGameName(r.gameId) }}:
          {{ getTeamName(r.team1Id) }} vs {{ getTeamName(r.team2Id) }}
        </ng-template>
      </li>
    </ul>
  </section>

  <div class="result-form" *ngIf="auth.getUser()?.role === 'admin'">
    <h3>Ergebnis eintragen</h3>
    <mat-form-field>
      <input matInput [(ngModel)]="matchId" placeholder="Match ID" />
    </mat-form-field>
    <mat-form-field>
      <input matInput type="number" [(ngModel)]="team1Score" placeholder="Team1 Score" />
    </mat-form-field>
    <mat-form-field>
      <input matInput type="number" [(ngModel)]="team2Score" placeholder="Team2 Score" />
    </mat-form-field>
    <button mat-raised-button color="accent" (click)="saveResult()">Speichern</button>
  </div>

  </ng-container>
</div>
