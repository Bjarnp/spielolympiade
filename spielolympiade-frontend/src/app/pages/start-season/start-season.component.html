<div class="start-season">
  <h2>Neue Spielolympiade starten</h2>

  <div *ngIf="step === 1">
    <h3>1. Spieler auswählen</h3>
    <mat-selection-list [(ngModel)]="selectedPlayers">
      <mat-list-option *ngFor="let p of players" [value]="p">
        {{ p.name }}
      </mat-list-option>
    </mat-selection-list>
    <button mat-raised-button color="primary" (click)="next()">Weiter</button>
  </div>

  <div *ngIf="step === 2">
    <h3>2. Teams erstellen</h3>
    <button mat-button (click)="generateTeams()">Zufallsgenerator</button>
    <div *ngFor="let t of teams; let i = index" class="team-row">
      <mat-form-field>
        <input matInput [(ngModel)]="t.name" placeholder="Teamname" />
      </mat-form-field>
      <span>{{ formatPlayers(t.playerIds) }}</span>
      <button mat-icon-button color="warn" (click)="removeTeam(i)">
        <mat-icon>delete</mat-icon>
      </button>
    </div>
    <h4>Manuell hinzufügen</h4>
    <mat-form-field>
      <input matInput [(ngModel)]="newTeamName" placeholder="Teamname" />
    </mat-form-field>
    <mat-form-field class="players-select">
      <mat-select multiple [(ngModel)]="newTeamPlayers" placeholder="Spieler">
        <mat-option *ngFor="let p of availablePlayers()" [value]="p.id">
          {{ p.name }}
        </mat-option>
      </mat-select>
    </mat-form-field>
    <button mat-raised-button color="accent" (click)="addTeam()">Hinzufügen</button>
    <br />
    <button mat-raised-button (click)="prev()">Zurück</button>
    <button mat-raised-button color="primary" (click)="next()">Weiter</button>
  </div>

  <div *ngIf="step === 3">
    <h3>3. Spiele auswählen</h3>
    <div *ngFor="let g of games">
      <mat-checkbox (change)="toggleGame(g.id, $event)">{{ g.name }}</mat-checkbox>
    </div>
    <h3>Turnierform
      <button mat-icon-button (click)="openInfo()" aria-label="Info">
        <mat-icon fontIcon="info"></mat-icon>
      </button>
    </h3>
    <mat-form-field>
      <mat-select [(ngModel)]="system" placeholder="System">
        <mat-option value="round_robin">Jeder gegen Jeden</mat-option>
        <mat-option value="single_elim">K.O.</mat-option>
        <mat-option value="double_elim">Double K.O.</mat-option>
        <mat-option value="group_ko">Gruppenphase + K.O.</mat-option>
      </mat-select>
    </mat-form-field>
    <p class="beer-info">Bierinfo: {{ getBeerInfo() }}</p>
    <br />
    <button mat-raised-button (click)="prev()">Zurück</button>
    <button mat-raised-button color="primary" (click)="next()">Weiter</button>
  </div>

  <div *ngIf="step === 4">
    <h3>4. Übersicht</h3>
    <p>{{ name }} ({{ year }})</p>
    <ul>
      <li *ngFor="let t of teams">
        {{ t.name }} - {{ formatPlayers(t.playerIds) }}
      </li>
    </ul>
    <p>Spiele: {{ selectedGameIds.map(getGameName).join(', ') }}</p>
    <p>System: {{ system }}</p>
    <button mat-raised-button (click)="prev()">Zurück</button>
    <button mat-raised-button color="accent" (click)="start()">Spielolympiade starten</button>
  </div>
</div>

<ng-template #systemInfo>
  <h2 mat-dialog-title>Information zur Turnierform</h2>
  <mat-dialog-content>
    <p *ngIf="system === 'round_robin'">
      Beim Jeder-gegen-Jeden spielt jedes Team gegen alle anderen Teams.
    </p>
    <p *ngIf="system === 'single_elim'">
      Beim K.O.-System scheidet ein Team nach einer Niederlage aus.
    </p>
    <p *ngIf="system === 'double_elim'">
      Beim Double K.O. scheidet ein Team erst nach zwei Niederlagen aus.
    </p>
    <p *ngIf="system === 'group_ko'">
      Teams spielen zunächst in Gruppen und die Besten treten im K.O.-System an.
    </p>
    <p>{{ getBeerInfo() }}</p>
  </mat-dialog-content>
  <mat-dialog-actions>
    <button mat-button mat-dialog-close>OK</button>
  </mat-dialog-actions>
</ng-template>
